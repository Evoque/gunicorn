
Gunicorn是一个WSGI HTTP服务器
一. 理解基本工作原理和核心概念 
二. Gunicorn整体架构
三. Gunicorn主要组件


## 1. 基本工作原理和核心概念
Gunicorn使用预分叉(pre-fork)工作模型，这意味着在启动时，主进程(Master)会预先创建多个工作进程(Worker)。这些工作进程负责处理传入的HTTP请求。
预分叉模型的优点是可以充分利用多核CPU，提高并发处理能力。

- [ ] 单个工作进程负责处理HTTP请求，谁负责请求的传递? 应该是Master，那Master依然会单点阻塞，只是请求分发占用的资源极少？
- [ ] 某个子进程崩溃，主进程进行重启的时候，原来的工作进程信息是否会保存(如进程ID)? 如果不保存，耦合进程信息的部分如何进行数据同步？
- [ ] Worker进程号称是进程安全的(线程安全?), 进程间是否可以通信，如果可以，如何通信？
- [ ] 主进程监控子进程的状态，根据需要增减。如何监控，如何增减？
- [ ] 对比浏览器的多进程架构, 如Chrome, Electron
- [ ] pre-fork model的优点：可控，子进程间可以有更细致的控制和同步
- [ ] pre-fork model的缺点：高并发时，创建、销毁会消耗更多的时间和资源
- [ ] post-fork model优点：需要时才会创建子进程，开销分散在执行过程中，不是集中在开始时
- [ ] post-fork model缺点：父进程和子进程的同步和通信可能更加复杂

### 主进程 (Master)
主进程负责管理整个服务器的运行，包括：
- 启动和停止工作进程
- 监控工作进程的状态
- 处理信号（如重启、停止等）

- [ ] 负载均衡：Master根据负载情况，将任务均匀分配给各Worker，实现负载。这一步是如何完成的？

### 工作进程（Worker）
工作进程是实际处理HTTP请求的进程。
每个工作进程独立运行，不共享内存，这样可以提高稳定性和安全性。
Gunicorn支持多种工作进程类型，包括sync、异步(eventlet、gevent)和线程(gthread)等.

- [ ] 进程间不共享内存，HTTP不同请求间的处理会不会有交集?
- [ ] Worker负责处理分配给它们的任务，任务处理完成后是否需要反馈给主进程，怎么反馈？
- [ ] Worker进程之间的通信有哪几种，分别怎么做，有什么优缺点? 如IPC
- [ ] Worker进程如果出现错误(崩溃)，如何同步给Master
- 

### 负载均衡
Gunicorn内置了简单的负载均衡机制，主进程会将传入的请求分发给各个工作进程处理。
这样可以均衡负载，避免某个工作进程过载.

- [ ] 负载均衡的原理是什么， Nginx是如何实现负载均衡的？
- [ ] 模拟实际的工作场景，如果需要进行负载均衡的调整该怎么办?
- [ ] 大数据集群、分布式数据库的负载均衡又是如何做的?
- [ ] 状态管理：Worker进程可能需要管理自己的状态，如任务执行的状态和必要的中间状态，在Gunicorn中这些是如何做的?
- [ ] 日志记录：各Worker有自己的日志信息，是如何记录和汇总的？


### 配置和启动
Gunicorn 可以通过命令行参数或配置文件进行配置。常见的配置选项包括工作进程数量、绑定地址和端口、工作进程类型等。
启动命令通常如下：
``` Bash

gunicorn --workers=2 myapp:app

```
其中`myapp:app`表示Python模块`myapp`中的WSGI应用对象`app`.

- [ ] 配置载入：Python如何通过命令行读取参数，在不同操作系统，有什么区别?
- [ ] 通过配置文件方式载入：梳理下配置文件的类型，以及每种配置文件的优劣势、应用场景，以及特别牛逼的软件的配置文件都有哪些？


### 与反向代理(Reverse Proxy)配合

在生产环境中，Gunicorn 通常与反向代理服务器（如 Nginx）配合使用。
Nginx处理静态文件和SSL终止，并将动态请求转发给 Gunicorn 处理。这样可以提高整体性能和安全性。

- [ ] 为什么叫Nginx为`反向代理服务器`(Reverse Proxy)? 
  + 中介：因其在客户端和服务器之间扮演一个中介角色
  + 隐藏后端服务器：隐藏后端服务器的实现细节和网络结构，Client不需要知道后端服务器的地址和配置
  + 负载均衡：可以分配客户端的请求到多个后端服务器上，提高应用程序的可用性和负担
  + SSL/TLS终端：可以处理SSL/TLS加密和解密工作，这样后端服务器就不需要处理这些，减轻后端服务器的负担
  + 缓存静态资源
  + 压缩和优化：Nginx可以对数据进行压缩，以及对静态内容进行优化，必须合并CSS/JS文件，减少HTTP请求
  + 安全性增强：反代提供了额外的安全层，如防止DDos攻击，隐藏真实IP地址
  + 连接复用：复用与后端服务的连接，减少连接建立和关闭的开销
  + 访问控制：反向代理可以根据不同的规则对客户端的访问进行控制，比如基于地理位置、IP地址等
  + 统一API入口：反代作为多个后端服务的统一入口点，简化客户端的请求逻辑
  + **故障转移和高可用性**：某个服务发生故障，Proxy自动把请求转发到健康服务器（这一步是如何实现的呢）
    - 服务宕机的标识：(Nginx支持哪些标识情况下转发健康服务，已有的标识是否能扩展)
      + 502 Bad Gateway: 服务器作为网关或代理，收到无效响应。【返回了，但内容和格式错误】
      + 503 Service Unavailable: 服务器过载或维护中; 临时状态。【未返回，一会可用】
      + 504 Gateway Timeout: 没有及时从上游服务器收到请求的响应。【未返回，不知道】
      + DNS：域名无法解析为IP地址
    - 与Keepalived等高可用解决方案结合使用
  + 日志记录和监控：Nginx可以记录所有经过它的请求的日志，方便监控和分析（研究下Nginx的日志体系，如何完整、高性能、并有一定扩展性的记录所有日志）


- [ ] 什么是SSL，什么是SSL终止?


## 2. Gunicorn整体架构


## 3. Gunicorn主要组件